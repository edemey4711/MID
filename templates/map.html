{% extends "base.html" %}
{% set fullscreen = true %}
{% block content %}

<style>
    html, body {
        height: 100%;
        margin: 0;
        padding: 0;
    }

    /* Karte soll den gesamten Bildschirm einnehmen */
    #map {
        position: absolute;
        top: 56px; /* HÃ¶he der Navbar */
        bottom: 0;
        left: 0;
        right: 0;
        width: 100%;
        height: calc(100% - 56px);
        margin: 0;
        padding: 0;
        z-index: 1; /* Karte unter Navbar */
    }

    /* iPhone Safari Fix */
    body {
        overflow: hidden;
    }
</style>

<div id="map"></div>

<script id="images-data" type="application/json">
{{ images | tojson }}
</script>

<script>
    const images = JSON.parse(document.getElementById('images-data').textContent);

    const menInDreckHelmetBadge = L.icon({
        iconUrl: "/static/icons/men-in-dreck-helmet.svg",
        iconSize: [48, 48],
        iconAnchor: [24, 48],
        popupAnchor: [0, -48]
    });

    const categoryIcons = {
    "Burg": L.icon({
        iconUrl: "/static/icons/burg.svg",
        iconSize: [48, 48],
        iconAnchor: [24, 48],
        popupAnchor: [0, -48]
    }),
    "Fels": L.icon({
        iconUrl: "/static/icons/fels.svg",
        iconSize: [48, 48],
        iconAnchor: [24, 48],
        popupAnchor: [0, -48]
    }),
    "Kirche": L.icon({
        iconUrl: "/static/icons/kirche.svg",
        iconSize: [48, 48],
        iconAnchor: [24, 48],
        popupAnchor: [0, -48]
    }),
    "Aussicht": L.icon({
        iconUrl: "/static/icons/aussicht.svg",
        iconSize: [48, 48],
        iconAnchor: [24, 48],
        popupAnchor: [0, -48]
    })
};

// Fallback-Icon
    const defaultIcon = L.icon({
        iconUrl: "/static/icons/default.svg",
        iconSize: [48, 48],
        iconAnchor: [24, 48],
        popupAnchor: [0, -48]
    });

    const map = L.map('map').setView([51.1657, 10.4515], 6);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19
    }).addTo(map);

    images.forEach(img => {
        const name = img[1] || "";
        const description = img[2] || "";
        const category = img[3] || "";
        const filepath = img[4] || "";
        let lat = img[5];
        let lon = img[6];

        if (!lat || isNaN(lat)) lat = 51.1657;
        if (!lon || isNaN(lon)) lon = 10.4515;

        const icon = categoryIcons[category] || defaultIcon;
        const marker = L.marker([lat, lon], { icon }).addTo(map);

        marker.bindPopup(`
            <b>${name}</b><br>
            Kategorie: ${category}<br>
            ${description}<br>
            <img src="${filepath}" width="150" class="mt-2 rounded">
        `);
    });
</script>

{% endblock %}