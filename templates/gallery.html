{% extends "base.html" %} {% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/gallery.css') }}">
{% endblock %} {% block content %}

<h1 class="mb-4 fw-bold">Galerie</h1>
<div class="card shadow-sm">
  <div class="card-body table-responsive custom-table">
    <table class="table table-striped align-middle">
      <thead class="table-dark">
        <tr>
          <th class="d-none d-md-table-cell">ID</th>
          <th>Vorschau</th>
          <th>Name</th>
          <th class="d-none d-lg-table-cell">Kategorie</th>
          <th class="d-none d-lg-table-cell">Beschreibung</th>
          <th class="d-none d-md-table-cell">Latitude</th>
          <th class="d-none d-md-table-cell">Longitude</th>
          <th>Aktion</th>
        </tr>
      </thead>

      <tbody>
        {% for img in images %}
        <tr>
          <!-- ID (versteckt auf kleinen Bildschirmen) -->
          <td class="align-middle d-none d-md-table-cell">{{ img[0] }}</td>

          <!-- Vorschau (verlinkt zur Detailseite) -->
          <td class="align-middle">
            <a
              href="{{ url_for('detail', image_id=img[0]) }}"
              title="Details ansehen"
              class="d-inline-block"
              style="cursor: pointer"
            >
              <img
                src="{% if img[5] %}{{ url_for('thumbnail_file', filename=img[5]) }}{% else %}{{ url_for('uploaded_file', filename=img[4]) }}{% endif %}"
                style="height: 60px"
                class="rounded shadow-sm preview-img"
                alt="{{ img[1] }}"
              />
            </a>
          </td>

          <!-- Name (mit Trunkierung auf kleinen Bildschirmen) -->
          <td class="align-middle">
            <span class="name-truncate">{{ img[1] }}</span>
          </td>

          <!-- Kategorie und Beschreibung (hidden on smaller screens) -->
          <td class="align-middle d-none d-lg-table-cell">{{ img[3] }}</td>
          <td class="align-middle d-none d-lg-table-cell" style="max-width:220px; overflow:hidden; text-overflow:ellipsis;">
            {{ img[2] }}
          </td>

          <!-- Latitude / Longitude: Link zur Map mit focus (hidden on mobile) -->
          <td class="align-middle d-none d-md-table-cell">
            <a href="{{ url_for('map') }}?focus={{ img[0] }}" title="In Karte anzeigen">
              {{ img[6] if img[6] else "–" }}
            </a>
          </td>
          <td class="align-middle d-none d-md-table-cell">
            <a href="{{ url_for('map') }}?focus={{ img[0] }}" title="In Karte anzeigen">
              {{ img[7] if img[7] else "–" }}
            </a>
          </td>

          <!-- Aktion (auf kleinen Geräten Buttons gestapelt) -->
          <td class="align-middle">
            <div class="gallery-action d-flex flex-column flex-md-row gap-1 align-items-start">
              <a href="{{ url_for('detail', image_id=img[0]) }}" class="btn btn-sm btn-outline-primary">Details</a>
              {% if session.role in ['uploader','admin'] %}
                <a href="{{ url_for('edit', image_id=img[0]) }}" class="btn btn-sm btn-dark">Bearbeiten</a>
                <form method="post" action="{{ url_for('delete', image_id=img[0]) }}" style="display:inline;">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Sicher löschen?')">Löschen</button>
                </form>
              {% endif %}
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}
